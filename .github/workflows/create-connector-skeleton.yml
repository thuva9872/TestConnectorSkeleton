name: Create MI Connector Skeleton

on:
  workflow_dispatch:
    inputs:
      connector_name:
        description: 'Connector name (e.g., salesforce, slack, jira) - lowercase, alphanumeric with hyphens only'
        required: true
        type: string
      connector_display_name:
        description: 'Connector display name (e.g., Salesforce, Slack, Jira)'
        required: true
        type: string
      connector_description:
        description: 'Brief description of the connector'
        required: true
        type: string
      connector_category:
        description: 'Connector category'
        required: true
        default: 'Developer Tools'
        type: choice
        options:
          - Developer Tools
          - CRM
          - Communication
          - Database
          - Cloud Services
          - Analytics
          - Marketing
          - Productivity
          - Other
      target_org:
        description: 'Target GitHub organization'
        required: true
        default: 'thuva9872'
        type: string
      target_repo:
        description: 'Target repository name (leave empty to auto-generate as mi-connector-<name>)'
        required: false
        type: string
        default: ''

  # Support reusable workflow calls from other repositories
  workflow_call:
    inputs:
      connector_name:
        description: 'Connector name (lowercase, alphanumeric with hyphens only)'
        required: true
        type: string
      connector_display_name:
        description: 'Connector display name'
        required: true
        type: string
      connector_description:
        description: 'Brief description of the connector'
        required: true
        type: string
      connector_category:
        description: 'Connector category'
        required: false
        type: string
        default: 'Developer Tools'
      target_org:
        description: 'Target GitHub organization'
        required: false
        type: string
        default: 'thuva9872'
      target_repo:
        description: 'Target repository name'
        required: false
        type: string
        default: ''
    secrets:
      BOT_TOKEN:
        description: 'GitHub token with repo permissions'
        required: true
      BOT_USERNAME:
        description: 'Bot username for git commits'
        required: true
      BOT_EMAIL:
        description: 'Bot email for git commits'
        required: true

# Prevent concurrent runs for the same connector
concurrency:
  group: connector-skeleton-${{ inputs.connector_name || github.event.inputs.connector_name }}
  cancel-in-progress: false

jobs:
  create-skeleton:
    runs-on: ubuntu-latest

    env:
      # Normalize inputs between workflow_dispatch and workflow_call
      CONNECTOR_NAME_INPUT: ${{ inputs.connector_name || github.event.inputs.connector_name }}
      CONNECTOR_DISPLAY_NAME_INPUT: ${{ inputs.connector_display_name || github.event.inputs.connector_display_name }}
      CONNECTOR_DESCRIPTION_INPUT: ${{ inputs.connector_description || github.event.inputs.connector_description }}
      CONNECTOR_CATEGORY_INPUT: ${{ inputs.connector_category || github.event.inputs.connector_category }}
      TARGET_ORG_INPUT: ${{ inputs.target_org || github.event.inputs.target_org }}
      TARGET_REPO_INPUT: ${{ inputs.target_repo || github.event.inputs.target_repo }}
      # Use appropriate token based on trigger type
      GH_TOKEN: ${{ secrets.BOT_TOKEN || secrets.WSO2_INTEGRATION_BOT_TOKEN }}
      GIT_USER_NAME: ${{ secrets.BOT_USERNAME || secrets.WSO2_INTEGRATION_BOT_USERNAME }}
      GIT_USER_EMAIL: ${{ secrets.BOT_EMAIL || secrets.WSO2_INTEGRATION_BOT_EMAIL }}

    steps:
      - name: Checkout template repository
        uses: actions/checkout@v4

      - name: Validate inputs
        id: validate
        run: |
          CONNECTOR_NAME="${{ env.CONNECTOR_NAME_INPUT }}"
          
          # Validate connector name format (lowercase, alphanumeric, hyphens only)
          if [[ ! "$CONNECTOR_NAME" =~ ^[a-z][a-z0-9-]*[a-z0-9]$|^[a-z]$ ]]; then
            echo "::error::Invalid connector name: '$CONNECTOR_NAME'. Must be lowercase, start with a letter, and contain only letters, numbers, and hyphens."
            exit 1
          fi
          
          # Check for reserved names
          RESERVED_NAMES=("test" "example" "sample" "template" "skeleton")
          for reserved in "${RESERVED_NAMES[@]}"; do
            if [[ "$CONNECTOR_NAME" == "$reserved" ]]; then
              echo "::error::Connector name '$CONNECTOR_NAME' is reserved and cannot be used."
              exit 1
            fi
          done
          
          echo "âœ… Input validation passed"
          echo "validated=true" >> $GITHUB_OUTPUT

      - name: Set up variables
        id: vars
        run: |
          CONNECTOR_NAME="${{ env.CONNECTOR_NAME_INPUT }}"
          CONNECTOR_NAME_LOWER=$(echo "$CONNECTOR_NAME" | tr '[:upper:]' '[:lower:]')
          CONNECTOR_NAME_CAPITALIZED=$(echo "$CONNECTOR_NAME" | sed 's/.*/\L&/; s/[a-z]*/\u&/g')
          
          # Use provided repo name or generate default
          if [ -n "${{ env.TARGET_REPO_INPUT }}" ]; then
            REPO_NAME="${{ env.TARGET_REPO_INPUT }}"
          else
            REPO_NAME="mi-connector-${CONNECTOR_NAME_LOWER}"
          fi
          
          BRANCH_NAME="feature/initial-skeleton"
          TIMESTAMP=$(date +%Y%m%d%H%M%S)
          
          echo "CONNECTOR_NAME=${CONNECTOR_NAME}" >> $GITHUB_OUTPUT
          echo "CONNECTOR_NAME_LOWER=${CONNECTOR_NAME_LOWER}" >> $GITHUB_OUTPUT
          echo "CONNECTOR_NAME_CAPITALIZED=${CONNECTOR_NAME_CAPITALIZED}" >> $GITHUB_OUTPUT
          echo "REPO_NAME=${REPO_NAME}" >> $GITHUB_OUTPUT
          echo "BRANCH_NAME=${BRANCH_NAME}" >> $GITHUB_OUTPUT
          echo "TARGET_ORG=${{ env.TARGET_ORG_INPUT }}" >> $GITHUB_OUTPUT
          echo "TIMESTAMP=${TIMESTAMP}" >> $GITHUB_OUTPUT
          
          echo "ðŸ“‹ Configuration Summary:"
          echo "  - Connector Name: ${CONNECTOR_NAME_LOWER}"
          echo "  - Display Name: ${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}"
          echo "  - Repository: ${{ env.TARGET_ORG_INPUT }}/${REPO_NAME}"
          echo "  - Branch: ${BRANCH_NAME}"

      - name: Create connector skeleton directory
        run: |
          mkdir -p skeleton-output
          cd skeleton-output
          
          # Create directory structure
          mkdir -p .github/workflows
          mkdir -p .connector-store
          mkdir -p src/main/assembly
          mkdir -p src/main/java
          mkdir -p src/main/resources
          mkdir -p src/test
          mkdir -p repository

      - name: Generate pom.xml
        run: |
          cat > skeleton-output/pom.xml << 'POMEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->

          <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

            <groupId>org.wso2.integration.connector</groupId>
            <artifactId>mi-connector-CONNECTOR_NAME_LOWER</artifactId>
            <version>0.1.0-SNAPSHOT</version>

            <name>WSO2 Carbon - CONNECTOR_DISPLAY_NAME Connector</name>
            <url>http://wso2.org</url>
            <packaging>jar</packaging>
            <modelVersion>4.0.0</modelVersion>

            <properties>
              <connector.name>CONNECTOR_NAME_LOWER</connector.name>
              <synapse.version>4.0.0-wso2v186</synapse.version>
              <axiom.version>1.2.11-wso2v21</axiom.version>
              <carbon.mediation.version>4.7.160</carbon.mediation.version>
            </properties>

            <dependencies>
              <dependency>
                <groupId>org.apache.synapse</groupId>
                <artifactId>synapse-core</artifactId>
                <version>${synapse.version}</version>
              </dependency>
              <dependency>
                <groupId>org.apache.synapse</groupId>
                <artifactId>synapse-commons</artifactId>
                <version>${synapse.version}</version>
              </dependency>
              <dependency>
                <groupId>org.wso2.carbon.mediation</groupId>
                <artifactId>org.wso2.carbon.connector.core</artifactId>
                <version>${carbon.mediation.version}</version>
              </dependency>
              <dependency>
                <groupId>org.apache.ws.commons.axiom</groupId>
                <artifactId>axiom-api</artifactId>
                <version>${axiom.version}</version>
              </dependency>
              <dependency>
                <groupId>junit</groupId>
                <artifactId>junit</artifactId>
                <version>4.13.2</version>
                <scope>test</scope>
              </dependency>
            </dependencies>
            <scm>
              <connection>scm:git:https://github.com/TARGET_ORG/mi-connector-CONNECTOR_NAME_LOWER.git</connection>
              <url>https://github.com/TARGET_ORG/mi-connector-CONNECTOR_NAME_LOWER.git</url>
              <developerConnection>scm:git:https://github.com/TARGET_ORG/mi-connector-CONNECTOR_NAME_LOWER</developerConnection>
              <tag>HEAD</tag>
            </scm>
            <build>
              <plugins>
                <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-release-plugin</artifactId>
                  <configuration>
                    <tagNameFormat>@{project.version}</tagNameFormat>
                  </configuration>
                </plugin>
                <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-compiler-plugin</artifactId>
                  <version>3.7.0</version>
                  <configuration>
                    <encoding>UTF-8</encoding>
                    <source>1.8</source>
                    <target>1.8</target>
                  </configuration>
                </plugin>
                <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-assembly-plugin</artifactId>
                  <executions>
                    <execution>
                      <id>build-connector</id>
                      <phase>compile</phase>
                      <goals>
                        <goal>single</goal>
                      </goals>
                      <configuration>
                        <finalName>${connector.name}-connector-${project.version}</finalName>
                        <appendAssemblyId>false</appendAssemblyId>
                        <filters>
                          <filter>src/main/assembly/filter.properties</filter>
                        </filters>
                        <descriptors>
                          <descriptor>src/main/assembly/assemble-connector.xml</descriptor>
                        </descriptors>
                      </configuration>
                    </execution>
                  </executions>
                </plugin>
              </plugins>
            </build>
            <repositories>
              <repository>
                <id>wso2-nexus</id>
                <name>WSO2 internal Repository</name>
                <url>https://maven.wso2.org/nexus/content/groups/wso2-public/</url>
                <releases>
                  <enabled>true</enabled>
                  <updatePolicy>daily</updatePolicy>
                  <checksumPolicy>ignore</checksumPolicy>
                </releases>
              </repository>
              <repository>
                <id>wso2.releases</id>
                <name>WSO2 internal Repository</name>
                <url>https://maven.wso2.org/nexus/content/repositories/releases/</url>
                <releases>
                  <enabled>true</enabled>
                  <updatePolicy>daily</updatePolicy>
                  <checksumPolicy>ignore</checksumPolicy>
                </releases>
              </repository>
              <repository>
                <id>wso2.snapshots</id>
                <name>Apache Snapshot Repository</name>
                <url>https://maven.wso2.org/nexus/content/repositories/snapshots/</url>
                <snapshots>
                  <enabled>true</enabled>
                  <updatePolicy>daily</updatePolicy>
                </snapshots>
                <releases>
                  <enabled>false</enabled>
                </releases>
              </repository>
            </repositories>
            <distributionManagement>
              <repository>
                <id>nexus-releases</id>
                <name>WSO2 Release Distribution Repository</name>
                <url>https://maven.wso2.org/nexus/content/repositories/releases/</url>
              </repository>
              <snapshotRepository>
                <id>wso2.snapshots</id>
                <name>Apache Snapshot Repository</name>
                <url>https://maven.wso2.org/nexus/content/repositories/snapshots/</url>
              </snapshotRepository>
            </distributionManagement>
          </project>
          POMEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/pom.xml
          sed -i "s/CONNECTOR_DISPLAY_NAME/${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}/g" skeleton-output/pom.xml
          sed -i "s/TARGET_ORG/${{ steps.vars.outputs.TARGET_ORG }}/g" skeleton-output/pom.xml

      - name: Generate README.md
        run: |
          cat > skeleton-output/README.md << 'READMEEOF'
          # CONNECTOR_DISPLAY_NAME Connector for WSO2 MI

          CONNECTOR_DESCRIPTION

          ### Compatibility

          | Connector Version | Supported WSO2 MI Version |
          |-------------------|---------------------------|
          | 0.1.0             | MI 4.5.0, MI 4.4.0        |


          ## Documentation

          Please refer to the [CONNECTOR_DISPLAY_NAME Connector Overview](https://mi.docs.wso2.com/en/latest/reference/connectors/) documentation.

          ### Building From the Source

          Follow the steps given below to build the connector from the source code:

          1. Get a clone or download the source from [Github](https://github.com/TARGET_ORG/mi-connector-CONNECTOR_NAME_LOWER/).
          2. Run the following Maven command from the `mi-connector-CONNECTOR_NAME_LOWER` directory: `mvn clean install`.
          3. The ZIP with the CONNECTOR_DISPLAY_NAME connector is created in the `mi-connector-CONNECTOR_NAME_LOWER/target` directory.
          READMEEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/README.md
          sed -i "s/CONNECTOR_DISPLAY_NAME/${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}/g" skeleton-output/README.md
          sed -i "s/CONNECTOR_DESCRIPTION/${{ env.CONNECTOR_DESCRIPTION_INPUT }}/g" skeleton-output/README.md
          sed -i "s/TARGET_ORG/${{ steps.vars.outputs.TARGET_ORG }}/g" skeleton-output/README.md

      - name: Generate .gitignore
        run: |
          cat > skeleton-output/.gitignore << 'GITIGNOREEOF'
          # Compiled class file
          *.class

          # Log file
          *.log

          # BlueJ files
          *.ctxt

          .idea/

          target/

          # Mobile Tools for Java (J2ME)
          .mtj.tmp/

          # Package Files #
          *.jar
          *.war
          *.nar
          *.ear
          *.zip
          *.tar.gz
          *.rar

          # virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
          hs_err_pid*
          replay_pid*
          GITIGNOREEOF

      - name: Generate LICENSE
        run: |
          cat > skeleton-output/LICENSE << 'LICENSEEOF'
                                           Apache License
                                     Version 2.0, January 2004
                                  http://www.apache.org/licenses/

             TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

             1. Definitions.

                "License" shall mean the terms and conditions for use, reproduction,
                and distribution as defined by Sections 1 through 9 of this document.

                "Licensor" shall mean the copyright owner or entity authorized by
                the copyright owner that is granting the License.

                "Legal Entity" shall mean the union of the acting entity and all
                other entities that control, are controlled by, or are under common
                control with that entity. For the purposes of this definition,
                "control" means (i) the power, direct or indirect, to cause the
                direction or management of such entity, whether by contract or
                otherwise, or (ii) ownership of fifty percent (50%) or more of the
                outstanding shares, or (iii) beneficial ownership of such entity.

                "You" (or "Your") shall mean an individual or Legal Entity
                exercising permissions granted by this License.

                "Source" form shall mean the preferred form for making modifications,
                including but not limited to software source code, documentation
                source, and configuration files.

                "Object" form shall mean any form resulting from mechanical
                transformation or translation of a Source form, including but
                not limited to compiled object code, generated documentation,
                and conversions to other media types.

                "Work" shall mean the work of authorship, whether in Source or
                Object form, made available under the License, as indicated by a
                copyright notice that is included in or attached to the work
                (an example is provided in the Appendix below).

                "Derivative Works" shall mean any work, whether in Source or Object
                form, that is based on (or derived from) the Work and for which the
                editorial revisions, annotations, elaborations, or other modifications
                represent, as a whole, an original work of authorship. For the purposes
                of this License, Derivative Works shall not include works that remain
                separable from, or merely link (or bind by name) to the interfaces of,
                the Work and Derivative Works thereof.

                "Contribution" shall mean any work of authorship, including
                the original version of the Work and any modifications or additions
                to that Work or Derivative Works thereof, that is intentionally
                submitted to the Licensor for inclusion in the Work by the copyright owner
                or by an individual or Legal Entity authorized to submit on behalf of
                the copyright owner. For the purposes of this definition, "submitted"
                means any form of electronic, verbal, or written communication sent
                to the Licensor or its representatives, including but not limited to
                communication on electronic mailing lists, source code control systems,
                and issue tracking systems that are managed by, or on behalf of, the
                Licensor for the purpose of discussing and improving the Work, but
                excluding communication that is conspicuously marked or otherwise
                designated in writing by the copyright owner as "Not a Contribution."

                "Contributor" shall mean Licensor and any individual or Legal Entity
                on behalf of whom a Contribution has been received by Licensor and
                subsequently incorporated within the Work.

             2. Grant of Copyright License. Subject to the terms and conditions of
                this License, each Contributor hereby grants to You a perpetual,
                worldwide, non-exclusive, no-charge, royalty-free, irrevocable
                copyright license to reproduce, prepare Derivative Works of,
                publicly display, publicly perform, sublicense, and distribute the
                Work and such Derivative Works in Source or Object form.

             3. Grant of Patent License. Subject to the terms and conditions of
                this License, each Contributor hereby grants to You a perpetual,
                worldwide, non-exclusive, no-charge, royalty-free, irrevocable
                (except as stated in this section) patent license to make, have made,
                use, offer to sell, sell, import, and otherwise transfer the Work,
                where such license applies only to those patent claims licensable
                by such Contributor that are necessarily infringed by their
                Contribution(s) alone or by combination of their Contribution(s)
                with the Work to which such Contribution(s) was submitted. If You
                institute patent litigation against any entity (including a
                cross-claim or counterclaim in a lawsuit) alleging that the Work
                or a Contribution incorporated within the Work constitutes direct
                or contributory patent infringement, then any patent licenses
                granted to You under this License for that Work shall terminate
                as of the date such litigation is filed.

             4. Redistribution. You may reproduce and distribute copies of the
                Work or Derivative Works thereof in any medium, with or without
                modifications, and in Source or Object form, provided that You
                meet the following conditions:

                (a) You must give any other recipients of the Work or
                    Derivative Works a copy of this License; and

                (b) You must cause any modified files to carry prominent notices
                    stating that You changed the files; and

                (c) You must retain, in the Source form of any Derivative Works
                    that You distribute, all copyright, patent, trademark, and
                    attribution notices from the Source form of the Work,
                    excluding those notices that do not pertain to any part of
                    the Derivative Works; and

                (d) If the Work includes a "NOTICE" text file as part of its
                    distribution, then any Derivative Works that You distribute must
                    include a readable copy of the attribution notices contained
                    within such NOTICE file, excluding those notices that do not
                    pertain to any part of the Derivative Works, in at least one
                    of the following places: within a NOTICE text file distributed
                    as part of the Derivative Works; within the Source form or
                    documentation, if provided along with the Derivative Works; or,
                    within a display generated by the Derivative Works, if and
                    wherever such third-party notices normally appear. The contents
                    of the NOTICE file are for informational purposes only and
                    do not modify the License. You may add Your own attribution
                    notices within Derivative Works that You distribute, alongside
                    or as an addendum to the NOTICE text from the Work, provided
                    that such additional attribution notices cannot be construed
                    as modifying the License.

                You may add Your own copyright statement to Your modifications and
                may provide additional or different license terms and conditions
                for use, reproduction, or distribution of Your modifications, or
                for any such Derivative Works as a whole, provided Your use,
                reproduction, and distribution of the Work otherwise complies with
                the conditions stated in this License.

             5. Submission of Contributions. Unless You explicitly state otherwise,
                any Contribution intentionally submitted for inclusion in the Work
                by You to the Licensor shall be under the terms and conditions of
                this License, without any additional terms or conditions.
                Notwithstanding the above, nothing herein shall supersede or modify
                the terms of any separate license agreement you may have executed
                with Licensor regarding such Contributions.

             6. Trademarks. This License does not grant permission to use the trade
                names, trademarks, service marks, or product names of the Licensor,
                except as required for reasonable and customary use in describing the
                origin of the Work and reproducing the content of the NOTICE file.

             7. Disclaimer of Warranty. Unless required by applicable law or
                agreed to in writing, Licensor provides the Work (and each
                Contributor provides its Contributions) on an "AS IS" BASIS,
                WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
                implied, including, without limitation, any warranties or conditions
                of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
                PARTICULAR PURPOSE. You are solely responsible for determining the
                appropriateness of using or redistributing the Work and assume any
                risks associated with Your exercise of permissions under this License.

             8. Limitation of Liability. In no event and under no legal theory,
                whether in tort (including negligence), contract, or otherwise,
                unless required by applicable law (such as deliberate and grossly
                negligent acts) or agreed to in writing, shall any Contributor be
                liable to You for damages, including any direct, indirect, special,
                incidental, or consequential damages of any character arising as a
                result of this License or out of the use or inability to use the
                Work (including but not limited to damages for loss of goodwill,
                work stoppage, computer failure or malfunction, or any and all
                other commercial damages or losses), even if such Contributor
                has been advised of the possibility of such damages.

             9. Accepting Warranty or Additional Liability. While redistributing
                the Work or Derivative Works thereof, You may choose to offer,
                and charge a fee for, acceptance of support, warranty, indemnity,
                or other liability obligations and/or rights consistent with this
                License. However, in accepting such obligations, You may act only
                on Your own behalf and on Your sole responsibility, not on behalf
                of any other Contributor, and only if You agree to indemnify,
                defend, and hold each Contributor harmless for any liability
                incurred by, or claims asserted against, such Contributor by reason
                of your accepting any such warranty or additional liability.

             END OF TERMS AND CONDITIONS

             APPENDIX: How to apply the Apache License to your work.

                To apply the Apache License to your work, attach the following
                boilerplate notice, with the fields enclosed by brackets "[]"
                replaced with your own identifying information. (Don't include
                the brackets!)  The text should be enclosed in the appropriate
                comment syntax for the file format. We also recommend that a
                file or class name and description of purpose be included on the
                same "printed page" as the copyright notice for easier
                identification within third-party archives.

             Copyright [yyyy] [name of copyright owner]

             Licensed under the Apache License, Version 2.0 (the "License");
             you may not use this file except in compliance with the License.
             You may obtain a copy of the License at

                 http://www.apache.org/licenses/LICENSE-2.0

             Unless required by applicable law or agreed to in writing, software
             distributed under the License is distributed on an "AS IS" BASIS,
             WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             See the License for the specific language governing permissions and
             limitations under the License.
          LICENSEEOF

      - name: Generate issue_template.md
        run: |
          cat > skeleton-output/issue_template.md << 'ISSUEEOF'
          **Description:**
          <!-- Give a brief description of the issue -->

          **Suggested Labels:**
          <!-- Optional comma separated list of suggested labels. Non committers can't assign labels to issues, so this will help issue creators who are not a committer to suggest possible labels-->

          **Suggested Assignees:**
          <!--Optional comma separated list of suggested team members who should attend the issue. Non committers can't assign issues to assignees, so this will help issue creators who are not a committer to suggest possible assignees-->

          **Affected Product Version:**

          **OS, DB, other environment details and versions:**    

          **Steps to reproduce:**


          **Related Issues:**
          <!-- Any related issues such as sub tasks, issues reported in other repositories (e.g component repositories), similar problems, etc. -->
          ISSUEEOF

      - name: Generate pull_request_template.md
        run: |
          cat > skeleton-output/pull_request_template.md << 'PREOF'
          ## Purpose
          > Describe the problems, issues, or needs driving this feature/fix and include links to related issues in the following format: Resolves issue1, issue2, etc.

          ## Goals
          > Describe the solutions that this feature/fix will introduce to resolve the problems described above

          ## Approach
          > Describe how you are implementing the solutions. Include an animated GIF or screenshot if the change affects the UI (email documentation@wso2.com to review all UI text). Include a link to a Markdown file or Google doc if the feature write-up is too long to paste here.

          ## User stories
          > Summary of user stories addressed by this change>

          ## Release note
          > Brief description of the new feature or bug fix as it will appear in the release notes

          ## Documentation
          > Link(s) to product documentation that addresses the changes of this PR. If no doc impact, enter "N/A" plus brief explanation of why there's no doc impact

          ## Training
          > Link to the PR for changes to the training content in https://github.com/wso2/WSO2-Training, if applicable

          ## Certification
          > Type "Sent" when you have provided new/updated certification questions, plus four answers for each question (correct answer highlighted in bold), based on this change. Certification questions/answers should be sent to certification@wso2.com and NOT pasted in this PR. If there is no impact on certification exams, type "N/A" and explain why.

          ## Marketing
          > Link to drafts of marketing content that will describe and promote this feature, including product page changes, technical articles, blog posts, videos, etc., if applicable

          ## Automation tests
           - Unit tests 
             > Code coverage information
           - Integration tests
             > Details about the test cases and coverage

          ## Security checks
           - Followed secure coding standards in http://wso2.com/technical-reports/wso2-secure-engineering-guidelines? yes/no
           - Ran FindSecurityBugs plugin and verified report? yes/no
           - Confirmed that this PR doesn't commit any keys, passwords, tokens, usernames, or other secrets? yes/no

          ## Samples
          > Provide high-level details about the samples related to this feature

          ## Related PRs
          > List any other related PRs

          ## Migrations (if applicable)
          > Describe migration steps and platforms on which migration has been tested

          ## Test environment
          > List all JDK versions, operating systems, databases, and browser/versions on which this feature/fix was tested
          PREOF

      - name: Generate assemble-connector.xml
        run: |
          cat > skeleton-output/src/main/assembly/assemble-connector.xml << 'ASSEMBLYEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->

          <assembly>
              <id>connector</id>
              <formats>
                  <format>zip</format>
              </formats>
              <includeBaseDirectory>false</includeBaseDirectory>
              <fileSets>
                  <fileSet>
                      <directory>target/connector/dependencies</directory>
                      <outputDirectory>lib</outputDirectory>
                  </fileSet>
                  <fileSet>
                      <directory>target/classes</directory>
                      <outputDirectory></outputDirectory>
                      <excludes>
                          <exclude>**/metrics_module.xml</exclude>
                          <exclude>**/META-INF/*</exclude>
                      </excludes>
                  </fileSet>
              </fileSets>
          </assembly>
          ASSEMBLYEOF

      - name: Generate filter.properties
        run: |
          cat > skeleton-output/src/main/assembly/filter.properties << 'FILTEREOF'
          product.name=WSO2 MI
          product.version=4.5.0
          FILTEREOF

      - name: Generate meta.json
        run: |
          cat > skeleton-output/.connector-store/meta.json << METAEOF
          {
              "name": "${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}",
              "owner": "WSO2",
              "product": "MI",
              "category": "${{ env.CONNECTOR_CATEGORY_INPUT }}",
              "documentationUrl": "https://mi.docs.wso2.com/en/4.4.0/",
              "mavenGroupId": "org.wso2.integration.connector",
              "mavenArtifactId": "mi-connector-${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}",
              "description": "${{ env.CONNECTOR_DESCRIPTION_INPUT }}",
              "status": "Active",
              "rank": 5,
              "type": "Connector",
              "releases": []
          }
          METAEOF

      - name: Generate placeholder logo
        run: |
          # Create a placeholder logo file (1x1 transparent PNG as base64)
          echo "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" | base64 -d > skeleton-output/.connector-store/logo.png

      - name: Generate CI workflow
        run: |
          cat > skeleton-output/.github/workflows/pull_request_ubuntu_build.yml << 'CIEOF'
          name: CI - Pull request - Ubuntu

          on:
            pull_request:
              branches: [ "main" ]

          jobs:
            build:

              runs-on: ubuntu-latest

              steps:
                - uses: actions/checkout@v4
                - name: Set up JDK 11
                  uses: actions/setup-java@v4
                  with:
                    java-version: '11'
                    distribution: 'temurin'
                    cache: maven
                - name: Build with Maven
                  run: mvn clean install
          CIEOF

      - name: Generate publish-release workflow
        run: |
          cat > skeleton-output/.github/workflows/publish-release.yml << 'RELEASEEOF'
          name: Publish Release

          on:
            workflow_dispatch:
              inputs: 
                update_preference:
                  description: 'Metadata update preference'
                  required: true
                  default: 'overwrite'
                  type: choice
                  options:
                    - overwrite
                    - add_new_entry

          jobs:
            Ubuntu:

              runs-on: ubuntu-latest

              steps:
                - name: Checkout
                  uses: actions/checkout@v2.3.3
                  with:
                    token: SECRETS_WSO2_INTEGRATION_BOT_TOKEN
                    fetch-depth: 0

                - name: Set up JDK 11
                  uses: joschi/setup-jdk@v2
                  with:
                    distribution: 'adopt'
                    java-version: 11

                - name: Set up Python
                  uses: actions/setup-python@v4
                  with:
                    python-version: '3.10'
                
                - name: Extract project version
                  run: |
                    VERSION=$(grep -oPm1 "(?<=<version>)[^<]+" pom.xml | sed 's/-SNAPSHOT$//')
                    VERSION_TAG="v$VERSION"
                    echo "VERSION_TAG=$VERSION_TAG" >> $GITHUB_ENV

                - name: Configure Maven settings file
                  run: |
                    mkdir -p ~/.m2
                    echo "<settings>
                            <servers>
                              <server>
                                <id>nexus-releases</id>
                                <username>SECRETS_NEXUS_USERNAME</username>
                                <password>SECRETS_NEXUS_PASSWORD</password>
                              </server>
                            </servers>
                          </settings>" > ~/.m2/settings.xml

                - name: Configure git credentials
                  run: |
                    git config --global user.name SECRETS_WSO2_INTEGRATION_BOT_USERNAME
                    git config --global user.email SECRETS_WSO2_INTEGRATION_BOT_EMAIL

                - name: Build artifacts
                  run: |
                    mvn clean install

                - name: Deploy artifacts with Maven
                  env:
                    GITHUB_TOKEN: SECRETS_WSO2_INTEGRATION_BOT_TOKEN
                  run: |
                    mvn --batch-mode release:prepare release:perform -Dtag=ENV_VERSION_TAG -Darguments="-Dmaven.javadoc.skip=true"

                - name: Create Github Release with Assets
                  env:
                    GITHUB_TOKEN: SECRETS_WSO2_INTEGRATION_BOT_TOKEN
                  run: |
                    find target/ -type f -name '*-SNAPSHOT.zip' -exec rm -f {} \;
                    gh release create "ENV_VERSION_TAG" \
                      --repo="$GITHUB_REPOSITORY" \
                      --title="ENV_VERSION_TAG" \
                      --generate-notes \
                      target/*.zip
          RELEASEEOF
          
          # Replace placeholders with actual GitHub Actions syntax
          # Using shell variable to prevent GitHub from evaluating the expressions
          DOLLAR='$'
          sed -i "s/SECRETS_WSO2_INTEGRATION_BOT_TOKEN/${DOLLAR}{{ secrets.WSO2_INTEGRATION_BOT_TOKEN }}/g" skeleton-output/.github/workflows/publish-release.yml
          sed -i "s/SECRETS_WSO2_INTEGRATION_BOT_USERNAME/${DOLLAR}{{ secrets.WSO2_INTEGRATION_BOT_USERNAME }}/g" skeleton-output/.github/workflows/publish-release.yml
          sed -i "s/SECRETS_WSO2_INTEGRATION_BOT_EMAIL/${DOLLAR}{{ secrets.WSO2_INTEGRATION_BOT_EMAIL }}/g" skeleton-output/.github/workflows/publish-release.yml
          sed -i "s/SECRETS_NEXUS_USERNAME/${DOLLAR}{{ secrets.NEXUS_USERNAME }}/g" skeleton-output/.github/workflows/publish-release.yml
          sed -i "s/SECRETS_NEXUS_PASSWORD/${DOLLAR}{{ secrets.NEXUS_PASSWORD }}/g" skeleton-output/.github/workflows/publish-release.yml
          sed -i "s/ENV_VERSION_TAG/${DOLLAR}{{ env.VERSION_TAG }}/g" skeleton-output/.github/workflows/publish-release.yml

      - name: Generate connector.xml
        run: |
          cat > skeleton-output/src/main/resources/connector.xml << 'CONNECTOREOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->
          <connector>
              <component name="CONNECTOR_NAME_LOWER" package="org.wso2.carbon.connector">
                  <dependency component="CONNECTOR_NAME_LOWER-config"/>
                  <!-- Add more component dependencies here -->
              </component>
              <description>CONNECTOR_DESCRIPTION</description>
          </connector>
          CONNECTOREOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/connector.xml
          sed -i "s/CONNECTOR_DESCRIPTION/${{ env.CONNECTOR_DESCRIPTION_INPUT }}/g" skeleton-output/src/main/resources/connector.xml

      - name: Generate component.xml for config
        run: |
          mkdir -p skeleton-output/src/main/resources/config
          cat > skeleton-output/src/main/resources/config/component.xml << 'COMPONENTEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->
          <component name="CONNECTOR_NAME_LOWER-config" type="synapse/template">
              <subComponents>
                  <component name="init">
                      <file>init.xml</file>
                      <description>Initialize the CONNECTOR_DISPLAY_NAME connector with connection parameters.</description>
                  </component>
              </subComponents>
          </component>
          COMPONENTEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/config/component.xml
          sed -i "s/CONNECTOR_DISPLAY_NAME/${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}/g" skeleton-output/src/main/resources/config/component.xml

      - name: Generate init.xml template
        run: |
          cat > skeleton-output/src/main/resources/config/init.xml << 'INITEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->
          <template name="init" xmlns="http://ws.apache.org/ns/synapse">
              <parameter name="connectionName" description="Unique name for the connection"/>
              <parameter name="baseUrl" description="Base URL of the CONNECTOR_DISPLAY_NAME API"/>
              <parameter name="apiKey" description="API Key for authentication (optional)"/>
              <parameter name="connectionTimeout" description="Connection timeout in milliseconds (default: 30000)"/>
              <sequence>
                  <property name="CONNECTOR_NAME_LOWER.connectionName" expression="$func:connectionName"/>
                  <property name="CONNECTOR_NAME_LOWER.baseUrl" expression="$func:baseUrl"/>
                  <property name="CONNECTOR_NAME_LOWER.apiKey" expression="$func:apiKey"/>
                  <property name="CONNECTOR_NAME_LOWER.connectionTimeout" expression="$func:connectionTimeout"/>
              </sequence>
          </template>
          INITEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/config/init.xml
          sed -i "s/CONNECTOR_DISPLAY_NAME/${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}/g" skeleton-output/src/main/resources/config/init.xml

      - name: Generate sample operation component
        run: |
          mkdir -p skeleton-output/src/main/resources/operations
          cat > skeleton-output/src/main/resources/operations/component.xml << 'OPCOMPEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->
          <component name="CONNECTOR_NAME_LOWER-operations" type="synapse/template">
              <subComponents>
                  <component name="sampleOperation">
                      <file>sampleOperation.xml</file>
                      <description>A sample operation template. Replace with actual operations.</description>
                  </component>
              </subComponents>
          </component>
          OPCOMPEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/operations/component.xml

      - name: Generate sample operation template
        run: |
          cat > skeleton-output/src/main/resources/operations/sampleOperation.xml << 'SAMPLEOPEOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <!--
           ~  Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
           ~
           ~  WSO2 LLC. licenses this file to you under the Apache License,
           ~  Version 2.0 (the "License"); you may not use this file except
           ~  in compliance with the License.
           ~  You may obtain a copy of the License at
           ~
           ~    http://www.apache.org/licenses/LICENSE-2.0
           ~
           ~  Unless required by applicable law or agreed to in writing,
           ~  software distributed under the License is distributed on an
           ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
           ~  KIND, either express or implied.  See the License for the
           ~  specific language governing permissions and limitations
           ~  under the License.
          -->
          <template name="sampleOperation" xmlns="http://ws.apache.org/ns/synapse">
              <parameter name="param1" description="First parameter"/>
              <parameter name="param2" description="Second parameter (optional)"/>
              <sequence>
                  <!-- Get connection properties -->
                  <property name="uri.var.baseUrl" expression="$ctx:CONNECTOR_NAME_LOWER.baseUrl"/>
                  <property name="uri.var.apiKey" expression="$ctx:CONNECTOR_NAME_LOWER.apiKey"/>
                  
                  <!-- Set operation parameters -->
                  <property name="uri.var.param1" expression="$func:param1"/>
                  <property name="uri.var.param2" expression="$func:param2"/>
                  
                  <!-- Build request payload -->
                  <payloadFactory media-type="json">
                      <format>
                          {
                              "param1": "$1",
                              "param2": "$2"
                          }
                      </format>
                      <args>
                          <arg evaluator="xml" expression="$ctx:uri.var.param1"/>
                          <arg evaluator="xml" expression="$ctx:uri.var.param2"/>
                      </args>
                  </payloadFactory>
                  
                  <!-- Set headers -->
                  <header name="Content-Type" value="application/json" scope="transport"/>
                  <header name="Authorization" expression="fn:concat('Bearer ', $ctx:uri.var.apiKey)" scope="transport"/>
                  
                  <!-- Make API call -->
                  <call>
                      <endpoint>
                          <http method="POST" uri-template="{uri.var.baseUrl}/api/sample"/>
                      </endpoint>
                  </call>
              </sequence>
          </template>
          SAMPLEOPEOF
          
          # Replace placeholders
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/operations/sampleOperation.xml

      - name: Generate uischema.json for connector UI
        run: |
          cat > skeleton-output/src/main/resources/uischema.json << UISCHEMAEOF
          {
            "connectorName": "${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}",
            "connectionName": "${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}",
            "title": "${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} Connector",
            "help": "${{ env.CONNECTOR_DESCRIPTION_INPUT }}",
            "elements": [
              {
                "type": "connection",
                "title": "${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} Connection",
                "name": "init",
                "value": {
                  "connectionName": "",
                  "baseUrl": "",
                  "apiKey": "",
                  "connectionTimeout": "30000"
                },
                "elements": [
                  {
                    "type": "attribute",
                    "value": {
                      "name": "connectionName",
                      "displayName": "Connection Name",
                      "inputType": "stringOrExpression",
                      "required": true,
                      "helpTip": "Unique name to identify the connection."
                    }
                  },
                  {
                    "type": "attribute",
                    "value": {
                      "name": "baseUrl",
                      "displayName": "Base URL",
                      "inputType": "stringOrExpression",
                      "required": true,
                      "helpTip": "Base URL of the ${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} API."
                    }
                  },
                  {
                    "type": "attribute",
                    "value": {
                      "name": "apiKey",
                      "displayName": "API Key",
                      "inputType": "stringOrExpression",
                      "required": false,
                      "helpTip": "API Key for authentication."
                    }
                  },
                  {
                    "type": "attribute",
                    "value": {
                      "name": "connectionTimeout",
                      "displayName": "Connection Timeout",
                      "inputType": "stringOrExpression",
                      "required": false,
                      "defaultValue": "30000",
                      "helpTip": "Connection timeout in milliseconds."
                    }
                  }
                ]
              },
              {
                "type": "operation",
                "title": "Sample Operation",
                "name": "sampleOperation",
                "value": {
                  "param1": "",
                  "param2": ""
                },
                "elements": [
                  {
                    "type": "attribute",
                    "value": {
                      "name": "param1",
                      "displayName": "Parameter 1",
                      "inputType": "stringOrExpression",
                      "required": true,
                      "helpTip": "First parameter for the operation."
                    }
                  },
                  {
                    "type": "attribute",
                    "value": {
                      "name": "param2",
                      "displayName": "Parameter 2",
                      "inputType": "stringOrExpression",
                      "required": false,
                      "helpTip": "Second parameter for the operation."
                    }
                  }
                ]
              }
            ]
          }
          UISCHEMAEOF

      - name: Update connector.xml with operations dependency
        run: |
          # Update connector.xml to include operations component
          sed -i 's|<dependency component="CONNECTOR_NAME_LOWER-config"/>|<dependency component="CONNECTOR_NAME_LOWER-config"/>\n            <dependency component="CONNECTOR_NAME_LOWER-operations"/>|g' skeleton-output/src/main/resources/connector.xml
          sed -i "s/CONNECTOR_NAME_LOWER/${{ steps.vars.outputs.CONNECTOR_NAME_LOWER }}/g" skeleton-output/src/main/resources/connector.xml

      - name: Add placeholder files for empty directories
        run: |
          touch skeleton-output/src/main/java/.gitkeep
          touch skeleton-output/src/test/.gitkeep
          touch skeleton-output/repository/.gitkeep

      - name: Verify target repository exists
        id: create_repo
        env:
          GH_TOKEN: ${{ env.GH_TOKEN }}
        run: |
          REPO_FULL_NAME="${{ steps.vars.outputs.TARGET_ORG }}/${{ steps.vars.outputs.REPO_NAME }}"
          
          echo "ðŸ“‹ Target repository: $REPO_FULL_NAME"
          echo "repo_existed=true" >> $GITHUB_OUTPUT
          echo "repo_created=false" >> $GITHUB_OUTPUT
          echo "âœ… Using existing repository: $REPO_FULL_NAME"

      - name: Configure Git Identity
        run: |
          git config --global user.name "${{ env.GIT_USER_NAME }}"
          git config --global user.email "${{ env.GIT_USER_EMAIL }}"
          echo "âœ… Git identity configured"

      - name: Clone target repository and prepare branch
        id: prepare_branch
        env:
          GH_TOKEN: ${{ env.GH_TOKEN }}
        run: |
          REPO_FULL_NAME="${{ steps.vars.outputs.TARGET_ORG }}/${{ steps.vars.outputs.REPO_NAME }}"
          BRANCH_NAME="${{ steps.vars.outputs.BRANCH_NAME }}"
          
          # Clone the target repository
          echo "ðŸ“¥ Cloning repository: $REPO_FULL_NAME"
          git clone "https://x-access-token:${{ env.GH_TOKEN }}@github.com/${REPO_FULL_NAME}.git" target-repo
          
          cd target-repo
          
          # Check if main branch exists, if not create it
          if ! git rev-parse --verify origin/main &>/dev/null; then
            echo "ðŸ“Œ Creating initial main branch"
            git checkout --orphan main
            git commit --allow-empty -m "chore: Initial commit"
            git push -u origin main
          else
            git checkout main
          fi
          
          # Check if feature branch already exists
          if git ls-remote --heads origin "$BRANCH_NAME" | grep -q "$BRANCH_NAME"; then
            echo "âš ï¸ Branch $BRANCH_NAME already exists"
            # Create a unique branch name with timestamp
            BRANCH_NAME="${BRANCH_NAME}-${{ steps.vars.outputs.TIMESTAMP }}"
            echo "ðŸ“Œ Using unique branch name: $BRANCH_NAME"
          fi
          
          # Create feature branch
          git checkout -b "$BRANCH_NAME"
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_OUTPUT
          echo "âœ… Branch '$BRANCH_NAME' created"

      - name: Copy skeleton files to target repository
        run: |
          cd target-repo
          
          # Copy skeleton files (excluding .git)
          cp -r ../skeleton-output/. .
          
          # Remove .gitkeep files if directories have content
          find . -name ".gitkeep" -type f -delete 2>/dev/null || true
          
          echo "âœ… Skeleton files copied"

      - name: Commit changes
        id: commit
        working-directory: target-repo
        run: |
          # Add all changes
          git add .
          
          # Check if there are changes to commit
          if git diff --cached --quiet; then
            echo "hasChanged=false" >> $GITHUB_OUTPUT
            echo "âš ï¸ No changes to commit - skeleton may already exist"
          else
            # Build commit message
            COMMIT_MSG="feat: Initialize ${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} connector skeleton structure

          This commit adds the initial project structure for the MI connector including:
          - Maven project configuration (pom.xml)
          - Assembly descriptor for connector packaging
          - CI/CD workflows (build and release)
          - Issue and PR templates
          - Connector store metadata
          
          Generated by: connector-skeleton-workflow
          Timestamp: ${{ steps.vars.outputs.TIMESTAMP }}"
            
            echo "$COMMIT_MSG" | git commit -F -
            echo "hasChanged=true" >> $GITHUB_OUTPUT
            echo "âœ… Changes committed successfully"
          fi

      - name: Push branch
        id: push
        if: ${{ steps.commit.outputs.hasChanged == 'true' }}
        working-directory: target-repo
        env:
          GH_TOKEN: ${{ env.GH_TOKEN }}
        run: |
          BRANCH_NAME="${{ steps.prepare_branch.outputs.branch_name }}"
          git push -u origin "$BRANCH_NAME"
          echo "âœ… Branch pushed to origin"

      - name: Create Pull Request
        id: create_pr
        if: ${{ steps.commit.outputs.hasChanged == 'true' }}
        working-directory: target-repo
        env:
          GH_TOKEN: ${{ env.GH_TOKEN }}
        run: |
          BRANCH_NAME="${{ steps.prepare_branch.outputs.branch_name }}"
          REPO_FULL_NAME="${{ steps.vars.outputs.TARGET_ORG }}/${{ steps.vars.outputs.REPO_NAME }}"
          
          # Create PR
          PR_URL=$(gh pr create \
            --repo "$REPO_FULL_NAME" \
            --title "feat: Initialize ${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} connector skeleton" \
            --body "## Summary

          This PR initializes the skeleton structure for the **${{ env.CONNECTOR_DISPLAY_NAME_INPUT }}** connector.

          ### Files Created:
          - \`pom.xml\` - Maven project configuration
          - \`README.md\` - Project documentation
          - \`LICENSE\` - Apache 2.0 License
          - \`.gitignore\` - Git ignore rules
          - \`issue_template.md\` - Issue template
          - \`pull_request_template.md\` - PR template
          - \`src/main/assembly/assemble-connector.xml\` - Assembly descriptor
          - \`src/main/assembly/filter.properties\` - Filter properties
          - \`src/main/resources/connector.xml\` - Main connector configuration
          - \`src/main/resources/uischema.json\` - UI schema for connector operations
          - \`src/main/resources/config/component.xml\` - Config component definition
          - \`src/main/resources/config/init.xml\` - Connection initialization template
          - \`src/main/resources/operations/component.xml\` - Operations component definition
          - \`src/main/resources/operations/sampleOperation.xml\` - Sample operation template
          - \`.connector-store/meta.json\` - Connector metadata
          - \`.connector-store/logo.png\` - Placeholder logo
          - \`.github/workflows/pull_request_ubuntu_build.yml\` - CI workflow
          - \`.github/workflows/publish-release.yml\` - Release workflow

          ### Directory Structure:
          \`\`\`
          ${{ steps.vars.outputs.REPO_NAME }}/
          â”œâ”€â”€ .connector-store/
          â”‚   â”œâ”€â”€ logo.png
          â”‚   â””â”€â”€ meta.json
          â”œâ”€â”€ .github/
          â”‚   â””â”€â”€ workflows/
          â”‚       â”œâ”€â”€ publish-release.yml
          â”‚       â””â”€â”€ pull_request_ubuntu_build.yml
          â”œâ”€â”€ repository/
          â”œâ”€â”€ src/
          â”‚   â”œâ”€â”€ main/
          â”‚   â”‚   â”œâ”€â”€ assembly/
          â”‚   â”‚   â”‚   â”œâ”€â”€ assemble-connector.xml
          â”‚   â”‚   â”‚   â””â”€â”€ filter.properties
          â”‚   â”‚   â”œâ”€â”€ java/
          â”‚   â”‚   â””â”€â”€ resources/
          â”‚   â”‚       â”œâ”€â”€ config/
          â”‚   â”‚       â”‚   â”œâ”€â”€ component.xml
          â”‚   â”‚       â”‚   â””â”€â”€ init.xml
          â”‚   â”‚       â”œâ”€â”€ operations/
          â”‚   â”‚       â”‚   â”œâ”€â”€ component.xml
          â”‚   â”‚       â”‚   â””â”€â”€ sampleOperation.xml
          â”‚   â”‚       â”œâ”€â”€ connector.xml
          â”‚   â”‚       â””â”€â”€ uischema.json
          â”‚   â””â”€â”€ test/
          â”œâ”€â”€ .gitignore
          â”œâ”€â”€ issue_template.md
          â”œâ”€â”€ LICENSE
          â”œâ”€â”€ pom.xml
          â”œâ”€â”€ pull_request_template.md
          â””â”€â”€ README.md
          \`\`\`

          ### Next Steps:
          1. Review and merge this PR
          2. Customize \`init.xml\` with connector-specific connection parameters
          3. Replace \`sampleOperation.xml\` with actual connector operations
          4. Update \`uischema.json\` to match your operations
          5. Implement Java classes in \`src/main/java/\` if needed
          6. Update \`meta.json\` with operation details
          7. Replace placeholder logo with actual connector logo

          ---
          *This PR was automatically generated by the connector skeleton workflow.*
          *Run ID: ${{ github.run_id }} | Triggered by: @${{ github.actor }}*" \
            --base main \
            --head "$BRANCH_NAME")
          
          echo "pr_url=$PR_URL" >> $GITHUB_OUTPUT
          echo "âœ… Pull Request created: $PR_URL"

      - name: Cleanup temporary files
        if: always()
        run: |
          rm -rf skeleton-output target-repo
          echo "ðŸ§¹ Cleanup completed"

      - name: Output summary
        if: always()
        run: |
          echo "## MI Connector Skeleton Workflow Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ steps.commit.outputs.hasChanged }}" = "true" ]; then
            echo "### âœ… Connector Skeleton Created Successfully!" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âš ï¸ No Changes Made" >> $GITHUB_STEP_SUMMARY
            echo "The skeleton structure may already exist in the repository." >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Property | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Connector Name** | ${{ env.CONNECTOR_DISPLAY_NAME_INPUT }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Repository** | [${{ steps.vars.outputs.TARGET_ORG }}/${{ steps.vars.outputs.REPO_NAME }}](https://github.com/${{ steps.vars.outputs.TARGET_ORG }}/${{ steps.vars.outputs.REPO_NAME }}) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Branch** | \`${{ steps.prepare_branch.outputs.branch_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Repository Created** | ${{ steps.create_repo.outputs.repo_created }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Changes Committed** | ${{ steps.commit.outputs.hasChanged }} |" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "${{ steps.create_pr.outputs.pr_url }}" ]; then
            echo "| **Pull Request** | ${{ steps.create_pr.outputs.pr_url }} |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. Review and merge the Pull Request" >> $GITHUB_STEP_SUMMARY
          echo "2. Add connector-specific operations in \`src/main/resources/\`" >> $GITHUB_STEP_SUMMARY
          echo "3. Implement Java classes in \`src/main/java/\`" >> $GITHUB_STEP_SUMMARY
          echo "4. Update \`meta.json\` with operation details" >> $GITHUB_STEP_SUMMARY
          echo "5. Replace placeholder logo with actual connector logo" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*Workflow run: [${{ github.run_id }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})*" >> $GITHUB_STEP_SUMMARY
